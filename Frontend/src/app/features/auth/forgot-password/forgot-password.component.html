<div class="auth-container">
    <h2>Forgot Password</h2>

    <p class="error" *ngIf="errorMsg">{{ errorMsg }}</p>
    <p class="success" *ngIf="successMsg">{{ successMsg }}</p>

    <!-- Step 1: Enter Email -->
    <form (submit)="onSendOtp(); $event.preventDefault()" *ngIf="step === 1">
        <p style="text-align: center; color: #666; margin-bottom: 20px;">
            Enter your registered email address and we'll send you an OTP to reset your password.
        </p>

        <label>Email</label>
        <input type="email" [(ngModel)]="email" name="email" required placeholder="name@example.com">

        <button type="submit" [disabled]="loading || !email">
            {{ loading ? 'Sending...' : 'Send OTP' }}
        </button>

        <p class="back-link">
            <a routerLink="/login">Back to Login</a>
        </p>
    </form>

    <!-- Step 2: Reset Password -->
    <form (submit)="onResetPassword(); $event.preventDefault()" *ngIf="step === 2">
        <p style="text-align: center; color: #666; margin-bottom: 20px;">
            Enter the OTP sent to <strong>{{ email }}</strong> and set your new password.
        </p>

        <label>OTP</label>
        <input type="text" [value]="otp" (input)="allowOnlyNumbers($event)" placeholder="123456" required maxlength="6"
            style="text-align: center; letter-spacing: 5px; font-size: 1.2em;">

        <label>New Password</label>
        <div class="password-wrapper">
            <input [type]="showPassword ? 'text' : 'password'" [(ngModel)]="newPassword" name="newPassword" required
                placeholder="Enter new password">
            <button type="button" class="toggle-password-btn" (click)="showPassword = !showPassword">
                <!-- Closed Lock (Hidden) -->
                <svg *ngIf="!showPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
                <!-- Open Lock (Visible) -->
                <svg *ngIf="showPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 9.9-1"></path>
                </svg>
            </button>
        </div>

        <label>Confirm New Password</label>
        <div class="password-wrapper">
            <input [type]="showConfirmPassword ? 'text' : 'password'" [(ngModel)]="confirmNewPassword"
                name="confirmNewPassword" required placeholder="Confirm new password">
            <button type="button" class="toggle-password-btn" (click)="showConfirmPassword = !showConfirmPassword">
                <!-- Closed Lock (Hidden) -->
                <svg *ngIf="!showConfirmPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                    viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
                <!-- Open Lock (Visible) -->
                <svg *ngIf="showConfirmPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                    viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 9.9-1"></path>
                </svg>
            </button>
        </div>

        <button type="submit" [disabled]="loading || !otp || !newPassword || !confirmNewPassword">
            {{ loading ? 'Resetting...' : 'Reset Password' }}
        </button>

        <p class="back-link">
            <a (click)="step = 1; otp=''; newPassword=''; confirmNewPassword=''" style="cursor: pointer;">Change
                Email</a>
        </p>
    </form>
</div>